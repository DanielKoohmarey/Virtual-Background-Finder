function downloadBlob(b,d){var a=document.createElement("a");a.style.display="none";document.body.appendChild(a);a.href=window.URL.createObjectURL(b);a.setAttribute("download",d);a.click();window.URL.revokeObjectURL(a.href);document.body.removeChild(a)}
var ImageUtility={updateSelectedImage:function(b){$(".gallery-images ul li img").css("animation","none");$("#download-btn").css("animation","glow-small 1s infinite alternate");$("#image-info").show();$("#author > a").attr("href",b.data("author-link")+"?utm_source=virtual_background_finder&utm_medium=referral");$("#author-name").text(b.data("author"));$("#background-img").attr("src",b.data("background-link"));$("#download-btn").data("download",b.data("download-link"));$("#download-btn").data("backup",
b.data("background-link"));$(".selected-image").removeClass("selected-image");b.addClass("selected-image")},updateImages:function(b){if(0<b.length){$(".page").empty();$(".page").hide();$(".page-button").hide();$(".selected-page").removeClass("selected-page");$("#open-modal").css("visibility","hidden");b.sort(function(h,k){return h.likes<k.likes?1:-1});for(var d=$(".page"),a=0;a<b.length;a++)if(null==b[a].sponsorship){var e=$('<li class="thumbnail-container">'),c=$("<img></img>");c.attr("src",b[a].urls.thumb);
c.data("author",b[a].user.name);c.data("author-link",b[a].user.links.html);c.data("download-link",b[a].links.download_location);c.data("background-link",b[a].urls.regular);var f=$("<div> <span> Preview </span> </div>"),g=Math.floor(a/8);e.appendTo(d[g]);c.appendTo(e);f.appendTo(e);var l=this;f.click(function(){l.updateSelectedImage($(this).prev())});0==a%8&&$($(".page-button")[g+1]).show()}$($(".page:first")).show();$($(".page-button")[1]).addClass("selected-page");$(".page-button").first().show();
$(".page-button").last().show()}else $(".modal-window > div > div").text("Unable to find any images matching your search, please try again with a new search term."),$(".modal-window").css("visibility","visible")},search:function(b){var d={};d["search-term"]=b;b=JSON.stringify(d);fetch("/unsplash/image",{method:"POST",headers:{"Content-Type":"application/json"},body:b}).then(function(a){return a.json()}).then(function(a){if(!a["api-valid"])throw"rate limited";ImageUtility.updateImages(a.images);$(".load-gallery").css("visibility",
"hidden");$(".gallery-images ul li img").css("animation","glow-small 1s infinite alternate")})["catch"](function(a){$(".modal-window > div > div").text("Our app is too popular at the moment, please try again later \ud83d\ude22.");$(".modal-window").css("visibility","visible");$(".load-gallery").css("visibility","hidden")})},requestDownload:function(b,d){var a={};a.image=b;a=JSON.stringify(a);fetch("/unsplash/download",{method:"POST",headers:{"Content-Type":"application/json"},body:a}).then(function(e){return e.json()}).then(function(e){ImageUtility.downloadImage(e.url)})["catch"](function(e){$(".modal-window > div > div")[0].innerHTML=
"Unable to to download image automatically \ud83d\ude22, please <a href='"+d+"' target='_blank'>download here.</a>";$(".modal-window").css("visibility","visible")})},downloadImage:function(b){fetch(b).then(function(d){return d.blob()}).then(function(d){var a=$("#search-input").data("history");a=a.replace(/[^a-z0-9]/gi,"_").toLowerCase();var e=$("#author-name").text();e=e.replace(/[^a-z0-9]/gi,"_").toLowerCase();downloadBlob(d,a+"_background_"+e+".jpg");confetti({particleCount:250,spread:160,origin:{x:0},
angle:60,startVelocity:90,gravity:.8,zIndex:99999999});confetti({particleCount:250,spread:160,origin:{x:1},angle:120,startVelocity:90,gravity:.8,zIndex:99999999});setTimeout(function(){var c=$(".social-icons")[0].innerHTML;c=c.replace($(".social-icons")[0].textContent.trim(),"");c=c.replace("fb-icon.jpg","fb-share.png");c=c.replace("twitter-icon.jpg","twitter-share.png");$(".modal-window > div > div")[0].innerHTML="Awesome background \ud83e\udd73!<br/>Please share this site if you found it useful \ud83d\ude4f:<br/>"+
c;$(".modal-window").css("visibility","visible")},2E3)})["catch"](function(d){$(".modal-window > div > div")[0].innerHTML="Unable to to download image automatically \ud83d\ude22, please <a href='"+b+"' target='_blank'>download here.</a>";$(".modal-window").css("visibility","visible")})}};